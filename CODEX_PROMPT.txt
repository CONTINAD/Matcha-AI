You are Codex 5.1, an expert AI systems architect and quantitative trading specialist. Transform the Matcha AI trading system located at /Users/alexaustin/Desktop/Matcha AI to be 20x more intelligent, profitable, and production-ready.

CURRENT STATE: The system has basic AI decision-making, ensemble voting, 15+ indicators, reinforcement learning, adaptive learning, and multi-timeframe analysis. It uses GPT-4, 0x Swap API, PostgreSQL, and supports backtesting/paper/live trading.

CRITICAL IMPROVEMENTS NEEDED (20X):

1. REAL DATA INTEGRATION (P0 - Highest Priority)
   - Replace mock data with CoinGecko Pro API for real-time + historical prices
   - Add Binance WebSocket for live streaming prices
   - Integrate DEX data via The Graph
   - Add data validation, caching (Redis), and real-time streaming
   - Implement order book analysis, volume profile, VWAP

2. ADVANCED MACHINE LEARNING (P0)
   - Integrate TensorFlow.js for neural network pattern recognition
   - Implement Deep Q-Network (DQN) for reinforcement learning with reward shaping based on Sharpe ratio
   - Fine-tune GPT-4 on trading-specific historical data
   - Add chain-of-thought prompting for better reasoning
   - Create model training pipeline with versioning and A/B testing

3. PROFITABILITY OPTIMIZATION (P0)
   - Implement smart order routing across multiple DEXs (Uniswap, Sushiswap, etc.)
   - Add TWAP/VWAP execution for large orders
   - Optimize gas usage, support Layer 2 (Arbitrum, Optimism)
   - Minimize slippage with better price impact models
   - Route through lowest-fee DEXs, batch transactions

4. ADVANCED RISK MANAGEMENT (P0)
   - Implement Value at Risk (VaR) and Conditional VaR (CVaR)
   - Add Kelly Criterion for optimal position sizing
   - Risk parity allocation across strategies
   - Drawdown protection with circuit breakers
   - Portfolio-level risk management

5. PORTFOLIO MANAGEMENT (P1)
   - Multi-strategy portfolio: Run multiple strategies simultaneously
   - Optimal capital allocation across strategies
   - Strategy correlation analysis to avoid over-concentration
   - Dynamic strategy selection based on market conditions
   - Performance attribution per strategy

6. ADVANCED BACKTESTING (P1)
   - Walk-forward analysis with rolling windows
   - Monte Carlo simulation for robustness testing
   - Parameter optimization (grid search, genetic algorithms)
   - Out-of-sample validation
   - Regime-aware backtesting

7. SYSTEM ARCHITECTURE (P1)
   - Microservices: Separate data, execution, AI services
   - Message queue (RabbitMQ/Kafka) for async processing
   - Redis caching layer for hot data
   - Database optimization with indexes and read replicas
   - Horizontal scaling support

8. MONITORING & OBSERVABILITY (P0)
   - Prometheus + Grafana for metrics
   - Structured logging with correlation IDs
   - Distributed tracing
   - Real-time performance dashboards
   - Alerting (PagerDuty integration)

9. SECURITY HARDENING (P0)
   - Private key management (HSM or secure storage)
   - Multi-sig wallet support
   - Rate limiting and input validation
   - Complete audit logging
   - Security audit and penetration testing

10. ADVANCED FEATURES (P1)
    - Market regime detection (trending/ranging/volatile) with automatic strategy switching
    - Sentiment analysis (Twitter/Reddit)
    - Cross-exchange arbitrage detection
    - MEV protection
    - Yield farming integration for idle capital

SUCCESS METRICS TO ACHIEVE:
- Win rate: >70% (currently ~50%)
- Sharpe ratio: >2.0 (currently ~0.5)
- Max drawdown: <10% (currently ~20%)
- ROI: >50% annual (currently ~10%)
- Decision latency: <100ms
- System uptime: 99.9%

IMPLEMENTATION PRIORITY:
Week 1-2: Real data integration, monitoring, security
Week 3-4: ML integration, advanced risk management
Week 5-6: Portfolio management, execution optimization
Week 7-8: Advanced backtesting, analytics
Week 9-10: Advanced features, optimization
Week 11-12: Production hardening, testing

TECHNICAL REQUIREMENTS:
- Add TensorFlow.js for ML models
- Add Redis for caching
- Add WebSocket support for real-time data
- Add Prometheus for metrics
- Create new services: dataAggregator, mlEngine, portfolioManager, executionEngine, riskEngine, analyticsEngine
- Enhance database schema with MLModel, Portfolio, Execution, RiskSnapshot tables
- All code must be TypeScript strict mode, >80% test coverage, fully documented

START BY:
1. Reading the current codebase structure
2. Implementing real data integration FIRST (biggest impact)
3. Adding advanced risk management
4. Optimizing execution
5. Then ML/AI enhancements

Remember: Profitability first, then intelligence, then features. A simple profitable system beats a complex unprofitable one.

Begin implementation now. Focus on P0 items first. Make it production-grade, highly profitable, and significantly more intelligent than the current system.

